from historical import ENGINE
from sqlalchemy import text
# Для последющего импорта следующие исключения

#-------------------------------------
# Битые категории - проверить на �
#-------------------------------------

# Чек на косяки
# select distinct category from history_sales where category like '%�%' order by 1 ASC;

# Лечение
# UPDATE history_sales
# SET category = REPLACE(category, 'Полк��', 'Полки');

# Часто кирилица и латиницы перепутаны 

# Лечение
# UPDATE history_sales
# SET category = translate(
#     category,
#     'aAeEoOpPcCyYxXkKmM',
#     'аАеЕоОрРсСуУхХкКмМ'
# )
# WHERE category ~ '[aAeEoOpPcCyYxXkKmM]';

CATS_EXCEPTIONS = {
    "м��лышей": "малышей",
    "��алышей": "малышей",
    "малыш��й": "малышей",
    "малыше��": "малышей",
    "малы��ей": "малышей",
    "ма��ышей": "малышей",

    "Бейсболк��": "Бейсболки",
    "Бе��сболки": "Бейсболки",

    "Блузк��": "Блузки",
    "��лузки": "Блузки",

    "Брю��и": "Брюки",
    "��рюки": "Брюки",

    "Водо��азки": "Водолазки",

    "Джинс��": "Джинсы",
    "Джи��сы": "Джинсы",
    "Дж��нсы": "Джинсы",
    "Д��инсы": "Джинсы",

    "Д��еггинсы": "Джеггинсы",
    "Леггин��ы": "Леггинсы",
    "Легг��нсы": "Леггинсы",
    "��еггинсы": "Леггинсы",

    "Д��емперы": "Джемперы",

    "Жилет��": "Жилеты",

    "Кард��ганы": "Кардиганы",
    "К��рдиганы": "Кардиганы",

    "Кол��отки": "Колготки",

    "Корз��нки": "Корзинки",
    "��орзинки": "Корзинки",

    "Кос��юмы": "Костюмы",
    "К��стюмы": "Костюмы",

    "к��пальные": "купальные",

    "д��я": "для",
    "��ля": "для",

    "Куртк��": "Куртки",
    "Курт��и": "Куртки",
    "К��ртки": "Куртки",
    "��уртки": "Куртки",

    "К��мбинезоны": "Комбинезоны",

    "К��оссовки": "Кроссовки",

    "Лонгслив��": "Лонгсливы",
    "Лонгсли��ы": "Лонгсливы",

    "Ло��еры": "Лоферы",

    "многор��зовые": "многоразовые",

    "декоративны��": "декоративные",
    "��екоративные": "декоративные",

    "Па��амы": "Пижамы",
    "Пижам��": "Пижамы",
    "Пижа��ы": "Пижамы",
    "Пиж��мы": "Пижамы",

    "Плат��я": "Платья",
    "Пла��ья": "Платья",
    "Пл��тья": "Платья",
    "��латья": "Платья",
    "П��атья": "Платья",

    "Полк��": "Полки",

    "По��отенца": "Полотенца",

    "Пух��вики": "Пуховики",
    "Пу��овики": "Пуховики",

    "П��нчо": "Пончо",

    "Ру��ашки": "Рубашки",
    "Р��башки": "Рубашки",
    "��убашки": "Рубашки",

    "Скатерт��": "Скатерти",
    "��катерти": "Скатерти",

    "оч��и": "очки",
    "Солнцеза��итные": "Солнцезащитные",
    "Сол��цезащитные": "Солнцезащитные",

    "С��ндалии": "Сандалии",

    "Толс��овки": "Толстовки",
    "Т��лстовки": "Толстовки",

    "То��ы": "Топы",
    "��опы": "Топы",

    "Футбо��ки": "Футболки",
    "Ф��тболки": "Футболки",

    "Шорт��": "Шорты",

    "��иджаки": "Пиджаки",
    
    "Бейсболки для м��лышей": "Бейсболки для малышей",
    "Бейсболк�� для малышей": "Бейсболки для малышей",
    "Боди для ��алышей": "Боди для малышей",
    "Брю��и для малышей": "Брюки для малышей",
    "Кард��ганы для малышей": "Кардиганы для малышей",
    "Кол��отки для малышей": "Колготки для малышей",
    "Костюмы для малыш��й": "Костюмы для малышей",
    "Костюмы для м��лышей": "Костюмы для малышей",
    "Костюмы к��пальные": "Костюмы купальные",
    "Кос��юмы для малышей": "Костюмы для малышей",
    "Куртки для малыш��й": "Куртки для малышей",
    "Куртки д��я малышей": "Куртки для малышей",
    "Куртки ��ля малышей": "Куртки для малышей",
    "К��рдиганы для малышей": "Кардиганы для малышей",
    "К��стюмы для малышей": "Костюмы для малышей",
    "Леггинсы для малыше��": "Леггинсы для малышей",
    "Маски многор��зовые": "Маски многоразовые",
    "Наволочки декоративны��": "Наволочки декоративные",
    "Наволочки ��екоративные": "Наволочки декоративные",
    "Полукомбинезоны ��ля малышей": "Полукомбинезоны для малышей",
    "По��отенца банные": "Полотенца банные",
    "Свитшоты для малы��ей": "Свитшоты для малышей",
    "Свитшоты для ма��ышей": "Свитшоты для малышей",
    "Солнцезащитные оч��и": "Солнцезащитные очки",
    "Солнцеза��итные очки": "Солнцезащитные очки",
    "Сол��цезащитные очки": "Солнцезащитные очки",
    "Топы для малы��ей": "Топы для малышей",
    "��рюки для малышей": "Брюки для малышей",
}


WH_REPLACEMENTS = {
    "Екатеринбур�� - Испытателей 14г": "Екатеринбург - Испытателей 14г",

    "Ка��ань": "Казань",
    "К��зань": "Казань",
    "��азань": "Казань",

    "Коледин��": "Коледино",
    "Коледи��о": "Коледино",
    "Колед��но": "Коледино",

    "Кот��вск": "Котовск",

    "Кр��снодар": "Краснодар",

    "Невинном��сск": "Невинномысск",
    "Невинно��ысск": "Невинномысск",
    "Неви��номысск": "Невинномысск",

    "Санкт-Петербург У��кина Заводь": "Санкт-Петербург Уткина Заводь",

    "Тул��": "Тула",
    "Ту��а": "Тула",
    "��ула": "Тула",

    "Ча��никово": "Чашниково",

    "Электростал��": "Электросталь",
    "Электрост��ль": "Электросталь",
    "Электрос��аль": "Электросталь",
    "Электро��таль": "Электросталь",
    "Электр��сталь": "Электросталь",
    "Элект��осталь": "Электросталь",
    "Э��ектросталь": "Электросталь",
}

def make_exception_cats():
    q = text("""
        UPDATE fixed_bars
        SET category = :good
        WHERE category = :bad
    """)

    with ENGINE.begin() as conn:
        for bad, good in CATS_EXCEPTIONS.items():
            print(good)
            conn.execute(q, {"bad": bad, "good": good})



def make_exception_wh():
    q = text("""
        UPDATE fixed_bars
        SET warehouse = :good
        WHERE warehouse = :bad
    """)

    with ENGINE.begin() as conn:
        for bad, good in WH_REPLACEMENTS.items():
            print(good)
            conn.execute(q, {"bad": bad, "good": good})
        
# make_exception_wh()
# make_exception()


#-------------------------------------
# Артикль WB и SA не соответстует
#-------------------------------------

# У нас SA артиклей больше и часто они странные например 
# select wb_article, seller_article from history_sales where wb_article = '176098402'
"176098402"	"1032006002"
"176098402"	"серо-корич"
# фиксить нужно при импорте 

# ниже запрос как это выявить

# SELECT
#     wb_article,
#     COUNT(DISTINCT seller_article) AS seller_cnt
# FROM history_sales
# GROUP BY wb_article
# HAVING COUNT(DISTINCT seller_article) > 1;


#-------------------------------------
# Бренды
#-------------------------------------

# чек

# select distinct 
# brand
# from history_sales
# where brand is not null

# Получаем

"bershka"
"Bershka"

# Классика. Фиксим Update 

# UPDATE history_sales
# set brand = 'Bershka'
# where brand = 'bershka'

