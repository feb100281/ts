{% load static humanize %}
<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>–ö–∞—Ä—Ç–æ—á–∫–∞ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞ ‚Äî {{ cp.name }}</title>
  <link rel="stylesheet" href="{% static 'fonts/glyphs.css' %}">
  <style>
    :root {
      --bg:#f3f4f6;
      --card:#ffffff;
      --border:#e5e7eb;
      --accent:#0f172a;
      --accent-soft:#111827;
      --muted:#6b7280;
    }
    * { box-sizing:border-box; }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin:0;
      padding:24px 12px;
      background:var(--bg);
      display:flex;
      justify-content:center;
    }

    .page-wrap {
      width:100%;
      max-width:720px;
      display:flex;
      justify-content:center;
    }

    .card {
      width:100%;
      background:var(--card);
      border-radius:16px;
      border:1px solid var(--border);
      padding:22px 24px 20px;
      box-shadow:0 18px 45px rgba(15,23,42,.12);
    }

    /* === TOOLBAR === */
    .toolbar {
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
      margin-bottom:14px;
    }

    .btn-back {
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:6px 12px;
      border-radius:6px;
      border:1px solid #cbd5e1;
      background:#ffffff;
      color:#111827;
      cursor:pointer;
      font-size:13px;
      text-decoration:none;
    }
    .btn-back:hover { background:#e5e7eb; }

    .btn-print {
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:6px 12px;
      border-radius:6px;
      border:1px solid #111827;
      background:#111827;
      color:#ffffff;
      cursor:pointer;
      font-size:13px;
    }
    .btn-print span.icon { font-size:14px; }
    .btn-print:hover { background:#020617; }

    /* === HEADER === */
    .card-header {
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:16px;
      margin-bottom:14px;
    }

    .logo-mark {
      width:64px;
      height:64px;
      border-radius:18px;
      background:radial-gradient(circle at 30% 0%, rgba(20,184,166,.7), rgba(15,23,42,1) 70%);
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow:0 14px 32px rgba(15,23,42,.45);
      flex-shrink:0;
      overflow:hidden;
    }
    .logo-glyph {
      font-family:NotoManu;
      font-size:32px;
      color:#e5fdf9;
      line-height:1;
    }
    .logo-empty {
      font-size:11px;
      color:#cbd5e1;
      text-transform:uppercase;
      letter-spacing:.08em;
    }

    .brand-block { flex:1 1 auto; }
    .brand-label {
      font-size:12px;
      text-transform:uppercase;
      letter-spacing:.12em;
      color:var(--muted);
      margin-bottom:4px;
    }
    .title {
      margin:0;
      font-size:20px;
      font-weight:700;
      color:var(--accent-soft);
    }
    .subtitle {
      margin-top:4px;
      color:var(--muted);
      font-size:13px;
    }

    .badge-group {
      padding:4px 10px;
      border-radius:6px;
      border:1px solid #d1d5db;
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:.10em;
      color:#374151;
      white-space:nowrap;
      margin-left:auto;
    }

    /* === SECTIONS === */
    .section { margin-top:16px; }
    .section-title {
      font-size:11px;
      font-weight:600;
      text-transform:uppercase;
      letter-spacing:.14em;
      color:var(--muted);
      margin-bottom:4px;
    }

    .subsection-header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:11px;
      color:#6b7280;
      margin:6px 0 2px;
    }
    .subsection-title {
      text-transform:uppercase;
      letter-spacing:.08em;
      font-weight:600;
      color:#4b5563;
    }
    .subsection-meta {
      font-size:11px;
      color:#9ca3af;
    }

    .info-grid {
      border-radius:10px;
      border:1px solid var(--border);
      padding:10px 12px;
      font-size:13px;
    }
    .info-row {
      display:flex;
      gap:8px;
      padding:3px 0;
    }
    .info-label {
      width:160px;
      flex-shrink:0;
      font-weight:600;
      color:var(--accent);
    }
    .info-value { color:var(--accent-soft); }

    .footer-note {
      margin-top:14px;
      font-size:11px;
      color:var(--muted);
      line-height:1.5;
    }

    a.site-link {
      color:#2563eb;
      text-decoration:none;
    }
    a.site-link:hover { text-decoration:underline; }

    /* === –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã === */
    .info-grid.financial {
      padding:8px 10px 10px;
    }

    .fin-columns {
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .fin-block-title {
      font-size:11px;
      font-weight:600;
      letter-spacing:.10em;
      text-transform:uppercase;
      color:#4b5563;
      margin-bottom:6px;
    }

    .fin-table {
      width:100%;
      border-collapse:collapse;
      font-size:12px;
      font-variant-numeric: tabular-nums;
    }

    .fin-table thead {
      background:#f9fafb;
    }

    .fin-table th,
    .fin-table td {
      padding:6px 10px;
      border-bottom:1px solid #e5e7eb;
    }

    .fin-table thead th {
      font-weight:600;
      color:var(--accent-soft);
      white-space:normal;
    }

    .fin-table th:first-child,
    .fin-table td:first-child {
      text-align:left;
    }

    .fin-table th:not(:first-child),
    .fin-table td.fin-num {
      text-align:right;
    }

    .fin-table tr:last-child td {
      border-bottom:none;
    }

    .fin-table .text-negative { color:#b91c1c; }
    .fin-table .text-positive { color:#15803d; }

    /* === KPI –ø–æ —Ñ–∏–Ω–∞–Ω—Å–∞–º (–º–∏–Ω–∏-–æ—Ç—á—ë—Ç) === */
    .metrics-grid {
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-bottom:10px;
      margin-top:6px;
    }
    .metric-card {
      flex:1 1 0;
      min-width:150px;
      border-radius:10px;
      border:1px solid #e5e7eb;
      background:#f9fafb;
      padding:8px 10px;
    }
    .metric-label {
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:.08em;
      color:#6b7280;
      margin-bottom:3px;
    }
    .metric-value {
      font-size:16px;
      font-weight:600;
      color:#111827;
    }
    .metric-sub {
      margin-top:2px;
      font-size:11px;
      color:#6b7280;
    }
    .metric-chip {
      display:inline-block;
      margin-top:4px;
      padding:2px 8px;
      border-radius:6px;
      font-size:11px;
      font-variant-numeric:tabular-nums;
    }
    .delta-positive {
      background:rgba(22,163,74,.08);
      color:#15803d;
    }
    .delta-negative {
      background:rgba(220,38,38,.08);
      color:#b91c1c;
    }

    /* === –î–æ–ª–≥–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞: —á–∏–ø-—Å–≤–µ—Ç–æ—Ñ–æ—Ä === */
    .debt-chip {
      display:inline-block;
      margin-top:4px;
      padding:2px 8px;
      border-radius:6px;
      font-size:11px;
      font-variant-numeric:tabular-nums;
      border:1px solid transparent;
    }
    .debt-low {
      background:rgba(22,163,74,.06);
      color:#166534;
      border-color:rgba(22,163,74,.25);
    }
    .debt-moderate {
      background:rgba(234,179,8,.06);
      color:#92400e;
      border-color:rgba(234,179,8,.35);
    }
    .debt-high {
      background:rgba(249,115,22,.06);
      color:#9a3412;
      border-color:rgba(249,115,22,.35);
    }
    .debt-critical {
      background:rgba(239,68,68,.06);
      color:#b91c1c;
      border-color:rgba(239,68,68,.35);
    }

    /* === –ú–∏–Ω–∏-–±–∞—Ä—á–∏–∫–∏ –ø–æ –≤—ã—Ä—É—á–∫–µ === */
    .mini-bars {
      margin-top:4px;
      margin-bottom:10px;
    }
    .mini-bar-row {
      display:flex;
      align-items:center;
      gap:6px;
      margin-bottom:4px;
      font-size:11px;
    }
    .mini-bar-label {
      width:40px;
      color:#6b7280;
      flex-shrink:0;
    }
    .mini-bar-track {
      flex:1 1 auto;
      height:6px;
      border-radius:6px;
      background:#e5e7eb;
      overflow:hidden;
    }
    .mini-bar-fill {
      height:100%;
      background:linear-gradient(90deg,#0ea5e9,#22c55e);
    }
    .mini-bar-value {
      width:110px;
      text-align:right;
      color:#374151;
      font-variant-numeric:tabular-nums;
      flex-shrink:0;
    }

    /* === –°–ø–∞—Ä–∫–ª–∞–π–Ω –¥–æ–ª–≥–æ–≤–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏ === */
    .mini-debt-bars {
      margin-top:4px;
      margin-bottom:10px;
    }
    .mini-debt-row {
      display:flex;
      align-items:center;
      gap:6px;
      margin-bottom:3px;
      font-size:11px;
    }
    .mini-debt-label {
      width:40px;
      color:#6b7280;
      flex-shrink:0;
    }
    .mini-debt-track {
      flex:1 1 auto;
      height:4px;
      border-radius:6px;
      background:#e5e7eb;
      overflow:hidden;
    }
    .mini-debt-fill {
      height:100%;
      background:linear-gradient(90deg,#22c55e,#f97316,#b91c1c);
    }
    .mini-debt-value {
      width:60px;
      text-align:right;
      color:#374151;
      font-variant-numeric:tabular-nums;
      flex-shrink:0;
    }

    @media (max-width: 600px) {
      body { padding:16px 8px; }
      .card { padding:18px 14px 14px; border-radius:14px; }
      .info-label { width:130px; }
    }

    @media print {
      @page { margin: 12mm; }
      body {
        background:#ffffff !important;
        padding:0 !important;
        margin:0 !important;
        display:block;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }
      .card {
        box-shadow:none !important;
        border-radius:0 !important;
        border:none !important;
      }
      .toolbar { display:none !important; }
      .fin-table .text-positive { color:#166534; }

      .metric-card,
      .mini-bar-track,
      .mini-bar-fill,
      .mini-debt-track,
      .mini-debt-fill {
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }
    }
  </style>
</head>
<body>
<div class="page-wrap">
  <div class="card">

    <!-- === TOOLBAR === -->
    <div class="toolbar">
      {% if request.GET.src == "change" %}
        <a href="{% url 'admin:counterparties_counterparty_change' cp.pk %}" class="btn-back">
          ‚Üê –ù–∞–∑–∞–¥ –∫ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—É
        </a>
      {% else %}
        <a href="{% url 'admin:counterparties_counterparty_changelist' %}" class="btn-back">
          ‚Üê –ö —Å–ø–∏—Å–∫—É –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤
        </a>
      {% endif %}

      <button class="btn-print" onclick="window.print()">
        <span class="icon">üñ®</span>
        <span>–†–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É</span>
      </button>
    </div>

    <!-- === HEADER === -->
    <div class="card-header">
      <div class="logo-mark">
        {% if cp.logo %}
          <span class="logo-glyph">{{ cp.logo }}</span>
        {% else %}
          <span class="logo-empty">NO&nbsp;LOGO</span>
        {% endif %}
      </div>

      <div class="brand-block">
        <div class="brand-label">–ö–∞—Ä—Ç–æ—á–∫–∞ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞</div>
        <h1 class="title">{{ cp.name }}</h1>
        <div class="subtitle">
          –ò–ù–ù {{ cp.tax_id }}{% if cp.ogrn %} ‚Ä¢ –û–ì–†–ù {{ cp.ogrn }}{% endif %}
        </div>
      </div>

      {% if cp.gr %}
        <div class="badge-group">
          {{ cp.gr.name }}
        </div>
      {% endif %}
    </div>

    <!-- === –†–ï–ö–í–ò–ó–ò–¢–´ === -->
    <div class="section">
      <div class="section-title">–†–µ–∫–≤–∏–∑–∏—Ç—ã</div>
      <div class="info-grid">
        <div class="info-row">
          <div class="info-label">–ü–æ–ª–Ω–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</div>
          <div class="info-value">
            {% if cp.fullname %}{{ cp.fullname }}{% else %}‚Äî{% endif %}
          </div>
        </div>
        <div class="info-row">
          <div class="info-label">–ò–ù–ù / –ö–ü–ü</div>
          <div class="info-value">
            {{ cp.tax_id }}{% if cp.kpp %} / {{ cp.kpp }}{% endif %}
          </div>
        </div>
        <div class="info-row">
          <div class="info-label">–°—Ç—Ä–∞–Ω–∞ / –†–µ–≥–∏–æ–Ω</div>
          <div class="info-value">
            {% if cp.country %}{{ cp.country }}{% else %}RU{% endif %}
            {% if cp.region %} ‚Ä¢ {{ cp.region }}{% endif %}
          </div>
        </div>
        <div class="info-row">
          <div class="info-label">–ê–¥—Ä–µ—Å</div>
          <div class="info-value">
            {% if cp.adress %}{{ cp.adress }}{% else %}‚Äî{% endif %}
          </div>
        </div>
      </div>
    </div>

    <!-- === –ö–û–ù–¢–ê–ö–¢–´ === -->
    <div class="section">
      <div class="section-title">–ö–æ–Ω—Ç–∞–∫—Ç—ã</div>
      <div class="info-grid">
        <div class="info-row">
          <div class="info-label">–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å</div>
          <div class="info-value">
            {% if cp.ceo %}
              {{ cp.ceo }}
              {% if cp.ceo_post %} ‚Äî {{ cp.ceo_post }}{% endif %}
            {% elif cp.ceo_hidden_by_fns %}
              –§–ò–û —Å–∫—Ä—ã—Ç–æ –§–ù–°
            {% else %}
              ‚Äî
            {% endif %}
          </div>
        </div>
        <div class="info-row">
          <div class="info-label">–°–∞–π—Ç</div>
          <div class="info-value">
            {% if website %}
              <a href="{{ website_full }}" class="site-link">{{ website }}</a>
            {% else %}
              ‚Äî
            {% endif %}
          </div>
        </div>
        <div class="info-row">
          <div class="info-label">Email</div>
          <div class="info-value">
            {% if cp.email %}{{ cp.email }}{% else %}‚Äî{% endif %}
          </div>
        </div>
      </div>
    </div>

    {% if cp.okved_code or cp.okved_name %}
      <div class="section">
        <div class="section-title">–û–ö–í–≠–î</div>
        <div class="info-grid">
          <div class="info-row">
            <div class="info-label">–ö–æ–¥</div>
            <div class="info-value">
              {% if cp.okved_code %}{{ cp.okved_code }}{% else %}‚Äî{% endif %}
            </div>
          </div>
          <div class="info-row">
            <div class="info-label">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</div>
            <div class="info-value">
              {% if cp.okved_name %}{{ cp.okved_name }}{% else %}‚Äî{% endif %}
            </div>
          </div>
        </div>
      </div>
    {% endif %}

    <!-- === –§–ò–ù–ê–ù–°–û–í–´–ï –ü–û–ö–ê–ó–ê–¢–ï–õ–ò === -->
    {% if financial_years %}
      <div class="section">
        <div class="section-title">
          –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
          {% if unit_label %}
            <span style="text-transform:none; letter-spacing:0; font-weight:400; color:#9ca3af;">
              (–≤ {{ unit_label }} ‚ÇΩ)
            </span>
          {% endif %}
        </div>

        {# KPI-–±–ª–æ–∫ #}
        {% if fin_summary %}
          <div class="metrics-grid">
            <div class="metric-card">
              <div class="metric-label">
                –í—ã—Ä—É—á–∫–∞, {{ fin_summary.year|stringformat:"i" }} –≥.
              </div>
              <div class="metric-value">
                {% if fin_summary.revenue is not None %}
                  {{ fin_summary.revenue|floatformat:1 }}
                  {% if unit_label %}{{ unit_label }}&nbsp;‚ÇΩ{% else %}‚ÇΩ{% endif %}
                {% else %}‚Äî{% endif %}
              </div>
              {% if fin_summary.change_abs %}
                <div class="metric-chip {% if fin_summary.change_abs > 0 %}delta-positive{% else %}delta-negative{% endif %}">
                  {% if fin_summary.change_abs > 0 %}+{% endif %}
                  {{ fin_summary.change_abs|floatformat:1 }}
                  {% if unit_label %}{{ unit_label }}&nbsp;‚ÇΩ{% else %}‚ÇΩ{% endif %}
                  {% if fin_summary.change_pct %}
                    ({{ fin_summary.change_pct|floatformat:1 }}&nbsp;%)
                  {% endif %}
                </div>
              {% else %}
                <div class="metric-sub">–î–∏–Ω–∞–º–∏–∫–∞ –∫ –ø—Ä–æ—à–ª–æ–º—É –≥–æ–¥—É –Ω–µ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–∞</div>
              {% endif %}
            </div>

            <div class="metric-card">
              <div class="metric-label">–†–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–¥–∞–∂</div>
              <div class="metric-value">
                {% if fin_summary.margin is not None %}
                  {{ fin_summary.margin|floatformat:1 }}&nbsp;%
                {% else %}‚Äî{% endif %}
              </div>
              <div class="metric-sub">
                –ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å / –≤—ã—Ä—É—á–∫–∞
              </div>
            </div>

            <div class="metric-card">
              <div class="metric-label">–î–æ–ª–≥–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞</div>
              <div class="metric-value">
                {% if fin_summary.debt_to_equity is not None %}
                  {{ fin_summary.debt_to_equity|floatformat:2 }}&nbsp;√ó
                {% else %}‚Äî{% endif %}
              </div>
              <div class="metric-sub">
                –î–æ–ª–≥ / —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–∞–ø–∏—Ç–∞–ª
              </div>
              {% if fin_summary.debt_level %}
                <div class="debt-chip debt-{{ fin_summary.debt_level }}">
                  {{ fin_summary.debt_level_label }}
                </div>
              {% endif %}
            </div>
          </div>
        {% endif %}

        {# –ú–∏–Ω–∏-–±–∞—Ä—ã –ø–æ –≤—ã—Ä—É—á–∫–µ #}
        <div class="subsection-header">
          <div class="subsection-title">–î–∏–Ω–∞–º–∏–∫–∞ –≤—ã—Ä—É—á–∫–∏</div>
          <div class="subsection-meta">
            {% if unit_label %}–∑–Ω–∞—á–µ–Ω–∏—è –≤ {{ unit_label }} ‚ÇΩ{% else %}–∑–Ω–∞—á–µ–Ω–∏—è –≤ ‚ÇΩ{% endif %}
          </div>
        </div>
        <div class="mini-bars">
          {% for fy in financial_years %}
            <div class="mini-bar-row">
              <div class="mini-bar-label">{{ fy.year|stringformat:"i" }}</div>
              <div class="mini-bar-track">
                <div class="mini-bar-fill" style="width:{{ fy.rev_rel }}%;"></div>
              </div>
              <div class="mini-bar-value">
                {% if fy.revenue_scaled is not None %}
                  {{ fy.revenue_scaled|floatformat:1 }}
                  {% if unit_label %}{{ unit_label }}&nbsp;‚ÇΩ{% else %}‚ÇΩ{% endif %}
                {% else %}‚Äî{% endif %}
              </div>
            </div>
          {% endfor %}
        </div>

        {# –°–ø–∞—Ä–∫–ª–∞–π–Ω –ø–æ –¥–æ–ª–≥–æ–≤–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ (Debt / Equity) #}
        <div class="subsection-header">
          <div class="subsection-title">–î–æ–ª–≥–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –ø–æ –≥–æ–¥–∞–º</div>
          <div class="subsection-meta">–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –î–æ–ª–≥ / –∫–∞–ø–∏—Ç–∞–ª, √ó</div>
        </div>
        <div class="mini-debt-bars">
          {% for fy in financial_years %}
            {% if fy.debt_to_equity is not None %}
              <div class="mini-debt-row">
                <div class="mini-debt-label">{{ fy.year|stringformat:"i" }}</div>
                <div class="mini-debt-track">
                  <div class="mini-debt-fill" style="width:{{ fy.de_rel }}%;"></div>
                </div>
                <div class="mini-debt-value">
                  {{ fy.debt_to_equity|floatformat:2 }}√ó
                </div>
              </div>
            {% endif %}
          {% endfor %}
        </div>

        <div class="info-grid financial">
          <div class="fin-columns">

            <!-- –ë–ª–æ–∫ 1: –ø—Ä–∏–±—ã–ª—å –∏ –î–î–° -->
            <div>
              <div class="fin-block-title">–ü—Ä–∏–±—ã–ª—å –∏ –¥–µ–Ω–µ–∂–Ω—ã–π –ø–æ—Ç–æ–∫</div>
              <table class="fin-table">
                <thead>
                  <tr>
                    <th>–ì–æ–¥</th>
                    <th>–í—ã—Ä—É—á–∫–∞</th>
                    <th>–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å</th>
                    <th>–û–ø–µ—Ä. –î–î–°</th>
                    <th>–†–µ–Ω—Ç–∞–±-—Å—Ç—å</th>
                  </tr>
                </thead>
                <tbody>
                {% for fy in financial_years %}
                  <tr>
                    <td>{{ fy.year|stringformat:"i" }}</td>

                    <td class="fin-num">
                      {% if fy.revenue_scaled is not None %}
                        {{ fy.revenue_scaled|floatformat:1 }}
                        {% if unit_label %}{{ unit_label }}&nbsp;‚ÇΩ{% else %}‚ÇΩ{% endif %}
                      {% else %}‚Äî{% endif %}
                    </td>

                    <td class="fin-num {% if fy.net_profit_scaled and fy.net_profit_scaled < 0 %}text-negative{% endif %}">
                      {% if fy.net_profit_scaled is not None %}
                        {{ fy.net_profit_scaled|floatformat:1 }}
                        {% if unit_label %}{{ unit_label }}&nbsp;‚ÇΩ{% else %}‚ÇΩ{% endif %}
                      {% else %}‚Äî{% endif %}
                    </td>

                    <td class="fin-num {% if fy.cf_operating_scaled and fy.cf_operating_scaled < 0 %}text-negative{% endif %}">
                      {% if fy.cf_operating_scaled is not None %}
                        {{ fy.cf_operating_scaled|floatformat:1 }}
                        {% if unit_label %}{{ unit_label }}&nbsp;‚ÇΩ{% else %}‚ÇΩ{% endif %}
                      {% else %}‚Äî{% endif %}
                    </td>

                    <td class="fin-num
                        {% if fy.margin is not None %}
                          {% if fy.margin < 0 %}text-negative{% else %}text-positive{% endif %}
                        {% endif %}">
                      {% if fy.margin is not None %}
                        {{ fy.margin|floatformat:1 }}&nbsp;%
                      {% else %}‚Äî{% endif %}
                    </td>
                  </tr>
                {% endfor %}
                </tbody>
              </table>
            </div>

            <!-- –ë–ª–æ–∫ 2: –∫–∞–ø–∏—Ç–∞–ª –∏ –¥–æ–ª–≥ -->
            <div>
              <div class="fin-block-title">–ö–∞–ø–∏—Ç–∞–ª –∏ –¥–æ–ª–≥–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞</div>
              <table class="fin-table">
                <thead>
                  <tr>
                    <th>–ì–æ–¥</th>
                    <th>–°–æ–±—Å—Ç–≤. –∫–∞–ø–∏—Ç–∞–ª</th>
                    <th>–î–æ–ª–≥–æ—Å—Ä. –æ–±—è–∑-–≤–∞</th>
                    <th>–ö—Ä–∞—Ç–∫–æ—Å—Ä. –æ–±—è–∑-–≤–∞</th>
                    <th>–î–æ–ª–≥ / –∫–∞–ø–∏—Ç–∞–ª</th>
                  </tr>
                </thead>
                <tbody>
                {% for fy in financial_years %}
                  <tr>
                    <td>{{ fy.year|stringformat:"i" }}</td>

                    <td class="fin-num">
                      {% if fy.equity_scaled is not None %}
                        {{ fy.equity_scaled|floatformat:1 }}
                        {% if unit_label %}{{ unit_label }}&nbsp;‚ÇΩ{% else %}‚ÇΩ{% endif %}
                      {% else %}‚Äî{% endif %}
                    </td>

                    <td class="fin-num">
                      {% if fy.liabilities_long_scaled is not None %}
                        {{ fy.liabilities_long_scaled|floatformat:1 }}
                        {% if unit_label %}{{ unit_label }}&nbsp;‚ÇΩ{% else %}‚ÇΩ{% endif %}
                      {% else %}‚Äî{% endif %}
                    </td>

                    <td class="fin-num">
                      {% if fy.liabilities_short_scaled is not None %}
                        {{ fy.liabilities_short_scaled|floatformat:1 }}
                        {% if unit_label %}{{ unit_label }}&nbsp;‚ÇΩ{% else %}‚ÇΩ{% endif %}
                      {% else %}‚Äî{% endif %}
                    </td>

                    <td class="fin-num">
                      {% if fy.debt_to_equity is not None %}
                        {{ fy.debt_to_equity|floatformat:2 }}&nbsp;√ó
                      {% else %}‚Äî{% endif %}
                    </td>
                  </tr>
                {% endfor %}
                </tbody>
              </table>
            </div>

          </div>
        </div>
      </div>
    {% endif %}

    <!-- === –†–ò–°–ö–ò / KYC === -->
    <div class="section">
      <div class="section-title">–§–∞–∫—Ç–æ—Ä—ã —Ä–∏—Å–∫–∞ / KYC</div>
      <div class="info-grid">

        <div class="info-row">
          <div class="info-label">–°–≤–æ–¥–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞</div>
          <div class="info-value">
            {% if cp.risk_sanctions or cp.risk_sanctioned_founder %}
              <span style="color:#b91c1c; font-weight:600;">–í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫</span>
            {% elif cp.risk_illegal_fin or cp.risk_mass_directors or cp.risk_mass_founders or cp.risk_disq_persons %}
              <span style="color:#f97316; font-weight:600;">–°—Ä–µ–¥–Ω–∏–π —Ä–∏—Å–∫</span>
            {% else %}
              <span style="color:#16a34a; font-weight:600;">–ù–∏–∑–∫–∏–π —Ä–∏—Å–∫</span>
            {% endif %}
          </div>
        </div>

        <div class="info-row">
          <div class="info-label">–î–∏—Å–∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–∏—Ü–∞</div>
          <div class="info-value">
            {% if cp.risk_disq_persons %}
              –í—ã—è–≤–ª–µ–Ω—ã –¥–∏—Å–∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–∏—Ü–∞, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–º.
            {% else %}
              –ù–µ –æ—Ç–º–µ—á–µ–Ω—ã –ø–æ –¥–∞–Ω–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–∞.
            {% endif %}
          </div>
        </div>

        <div class="info-row">
          <div class="info-label">–ú–∞—Å—Å–æ–≤—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞ / —É—á—Ä–µ–¥–∏—Ç–µ–ª–∏</div>
          <div class="info-value">
            {% if cp.risk_mass_directors or cp.risk_mass_founders %}
              {% if cp.risk_mass_directors %}–ú–∞—Å—Å–æ–≤—ã–µ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–∏{% endif %}
              {% if cp.risk_mass_directors and cp.risk_mass_founders %} / {% endif %}
              {% if cp.risk_mass_founders %}–º–∞—Å—Å–æ–≤—ã–µ —É—á—Ä–µ–¥–∏—Ç–µ–ª–∏{% endif %}.
            {% else %}
              –ü—Ä–∏–∑–Ω–∞–∫–æ–≤ –º–∞—Å—Å–æ–≤—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–æ–≤ –∏–ª–∏ —É—á—Ä–µ–¥–∏—Ç–µ–ª–µ–π –Ω–µ –≤—ã—è–≤–ª–µ–Ω–æ.
            {% endif %}
          </div>
        </div>

        <div class="info-row">
          <div class="info-label">–ù–µ–ª–µ–≥–∞–ª—å–Ω—ã–µ —Å—Ö–µ–º—ã / —Ñ–∏–Ω–∞–Ω—Å—ã</div>
          <div class="info-value">
            {% if cp.risk_illegal_fin %}
              –û—Ç–º–µ—á–µ–Ω—ã –ø—Ä–∏–∑–Ω–∞–∫–∏ —É—á–∞—Å—Ç–∏—è –≤ –Ω–µ–ª–µ–≥–∞–ª—å–Ω—ã—Ö —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö.
              {% if cp.risk_illegal_fin_status %}
                –°—Ç–∞—Ç—É—Å: {{ cp.risk_illegal_fin_status }}.
              {% endif %}
            {% else %}
              –ü—Ä–∏–∑–Ω–∞–∫–æ–≤ –Ω–µ–ª–µ–≥–∞–ª—å–Ω—ã—Ö —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Å—Ö–µ–º –Ω–µ –≤—ã—è–≤–ª–µ–Ω–æ.
            {% endif %}
          </div>
        </div>

        <div class="info-row">
          <div class="info-label">–°–∞–Ω–∫—Ü–∏–∏</div>
          <div class="info-value">
            {% if cp.risk_sanctions or cp.risk_sanctioned_founder %}
              –ï—Å—Ç—å —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω—ã–µ —Ä–∏—Å–∫–∏
              {% if cp.risk_sanctioned_founder %} (—Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω—ã–π —É—á—Ä–µ–¥–∏—Ç–µ–ª—å){% endif %}.
              {% if cp.risk_sanctions_countries %}
                –°—Ç—Ä–∞–Ω—ã / —é—Ä–∏—Å–¥–∏–∫—Ü–∏–∏: {{ cp.risk_sanctions_countries }}.
              {% endif %}
            {% else %}
              –°–∞–Ω–∫—Ü–∏–æ–Ω–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –¥–∞–Ω–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –Ω–µ –≤—ã—è–≤–ª–µ–Ω—ã.
            {% endif %}
          </div>
        </div>

      </div>
    </div>

    <div class="footer-note">
      –ö–∞—Ä—Ç–æ—á–∫–∞ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤ —Å–∏—Å—Ç–µ–º–µ.
      {% if cp.checko_updated_at %}
        –î–∞–Ω–Ω—ã–µ –§–ù–° –∞–∫—Ç—É–∞–ª—å–Ω—ã –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—é –Ω–∞ {{ cp.checko_updated_at|date:"d.m.Y" }}.
      {% endif %}
      –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–µ–∫–≤–∏–∑–∏—Ç–æ–≤ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏
      —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é.
    </div>

  </div>
</div>
</body>
</html>






