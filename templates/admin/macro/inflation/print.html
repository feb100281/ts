{% load static %}

<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>
    –ò–Ω—Ñ–ª—è—Ü–∏—è{% if current_rate_date %} –Ω–∞ {{ current_rate_date|date:"d.m.Y" }}{% endif %} ‚Äî –ø–µ—á–∞—Ç—å
  </title>

  {# –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º CSS –¥–ª—è –∫–ª—é—á–µ–≤–æ–π —Å—Ç–∞–≤–∫–∏ #}
  <link rel="stylesheet" href="{% static 'macro/keyrate_print.css' %}">
  <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
</head>

<body>
<div class="page-wrap">

  <div class="card">

    {# —Ç—É–ª–±–∞—Ä #}
    <div class="toolbar">
      <a href="{% url 'admin:macro_inflation_changelist' %}" class="btn-back">
        ‚Üê –ö —Å–ø–∏—Å–∫—É –∏–Ω—Ñ–ª—è—Ü–∏–∏
      </a>

      <button class="btn-print" onclick="window.print()">
        <span class="icon">üñ®</span>
        <span>–ü–µ—á–∞—Ç—å</span>
      </button>
    </div>

    {# —à–∞–ø–∫–∞ #}
    <div class="header">
      <div class="title-block">
        <div class="title-label">–ú–∞–∫—Ä–æ—ç–∫–æ–Ω–æ–º–∏–∫–∞</div>
        <h1>–ò–Ω—Ñ–ª—è—Ü–∏—è (–∏–Ω–¥–µ–∫—Å –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å—Å–∫–∏—Ö —Ü–µ–Ω)</h1>

        {% if current_rate and current_rate_date %}
          <div class="subtitle">
            –ü–æ —Å–æ—Å—Ç–æ—è–Ω–∏—é –Ω–∞
            <strong>{{ current_rate_date|date:"d.m.Y" }}</strong>
            –≥–æ–¥–æ–≤–∞—è –∏–Ω—Ñ–ª—è—Ü–∏—è (–ò–ü–¶, –≥–æ–¥ –∫ –≥–æ–¥—É) —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç
            <strong>{{ current_rate|floatformat:2 }}%</strong>.

            {% if rate_change is not None %}
              {% if rate_change > 0 %}
                –ü–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ–º –∏–Ω—Ñ–ª—è—Ü–∏—è
                <strong>–≤—ã—Ä–æ—Å–ª–∞ –Ω–∞ {{ rate_change|floatformat:2 }} –ø.–ø.</strong>.
              {% elif rate_change < 0 %}
                –ü–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ–º –∏–Ω—Ñ–ª—è—Ü–∏—è
                <strong>—Å–Ω–∏–∑–∏–ª–∞—Å—å –Ω–∞ {{ rate_change|floatformat:2 }} –ø.–ø.</strong>.
              {% else %}
                –£—Ä–æ–≤–µ–Ω—å –∏–Ω—Ñ–ª—è—Ü–∏–∏ <strong>–Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è</strong> –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è.
              {% endif %}
            {% endif %}

            {% if diff_to_target is not None %}
              {% if diff_to_target > 0 %}
                –¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å –∏–Ω—Ñ–ª—è—Ü–∏–∏ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è
                <strong>–≤—ã—à–µ —Ü–µ–ª–µ–≤–æ–≥–æ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–∞ –ë–∞–Ω–∫–∞ –†–æ—Å—Å–∏–∏</strong>
                ({{ target_rate|floatformat:1 }}%) –Ω–∞
                <strong>{{ diff_to_target|floatformat:2 }} –ø.–ø.</strong>.
              {% elif diff_to_target < 0 %}
                –¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å –∏–Ω—Ñ–ª—è—Ü–∏–∏ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è
                <strong>–Ω–∏–∂–µ —Ü–µ–ª–µ–≤–æ–≥–æ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–∞ –ë–∞–Ω–∫–∞ –†–æ—Å—Å–∏–∏</strong>
                ({{ target_rate|floatformat:1 }}%) –Ω–∞
                <strong>{{ diff_to_target|floatformat:2 }} –ø.–ø.</strong>.
              {% else %}
                –¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å –∏–Ω—Ñ–ª—è—Ü–∏–∏ <strong>—Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ü–µ–ª–µ–≤—ã–º —É—Ä–æ–≤–Ω–µ–º</strong>
                –ë–∞–Ω–∫–∞ –†–æ—Å—Å–∏–∏ ({{ target_rate|floatformat:1 }}%).
              {% endif %}
            {% endif %}
          </div>
        {% endif %}
      </div>

      <div class="tag">–ö–∞—Ä—Ç–æ—á–∫–∞ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è</div>
    </div>

    {# I. –°–≤–æ–¥–∫–∞ #}
    <div class="section">
      <div class="section-title">I. –°–≤–æ–¥–∫–∞</div>
      <div class="section-sub">
        –¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–Ω—Ñ–ª—è—Ü–∏–∏, –¥–∏–Ω–∞–º–∏–∫–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞
        –∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ—Ç —Ü–µ–ª–µ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è –ë–∞–Ω–∫–∞ –†–æ—Å—Å–∏–∏.
      </div>

      <div class="summary-grid">
        <div class="summary-item">
          <div class="summary-label">–î–∞—Ç–∞ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è</div>
          <div class="summary-value">
            {% if current_rate_date %}
              {{ current_rate_date|date:"d.m.Y" }}
            {% else %}
              ‚Äî
            {% endif %}
          </div>
        </div>

        <div class="summary-item">
          <div class="summary-label">–ò–Ω—Ñ–ª—è—Ü–∏—è, –≥–æ–¥ –∫ –≥–æ–¥—É</div>
          <div class="summary-value">
            {% if current_rate %}
              {{ current_rate|floatformat:2 }}%
            {% else %}
              ‚Äî
            {% endif %}
          </div>
        </div>

        <div class="summary-item">
          <div class="summary-label">–ü—Ä–µ–¥—ã–¥—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ</div>
          <div class="summary-value">
            {% if prev_rate_date and prev_rate %}
              {{ prev_rate_date|date:"d.m.Y" }} ‚Äî {{ prev_rate|floatformat:2 }}%
            {% else %}
              ‚Äî
            {% endif %}
          </div>

          {% if rate_change is not None %}
            {# –î–ª—è –∏–Ω—Ñ–ª—è—Ü–∏–∏: —Ä–æ—Å—Ç = –ø–ª–æ—Ö–æ (–∫—Ä–∞—Å–Ω—ã–π), –ø–∞–¥–µ–Ω–∏–µ = —Ö–æ—Ä–æ—à–æ (–∑–µ–ª—ë–Ω—ã–π) #}
            {% if rate_change > 0 %}
              <div class="delta-down">
                ‚ñ≤ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –ø–µ—Ä–∏–æ–¥—É:
                +{{ rate_change|floatformat:2 }} –ø.–ø.
              </div>
            {% elif rate_change < 0 %}
              <div class="delta-up">
                ‚ñº –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –ø–µ—Ä–∏–æ–¥—É:
                {{ rate_change|floatformat:2 }} –ø.–ø.
              </div>
            {% else %}
              <div class="delta-flat">
                ‚ñ† –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞.
              </div>
            {% endif %}
          {% endif %}
        </div>

        <div class="summary-item">
          <div class="summary-label">–û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ—Ç —Ü–µ–ª–∏ –¶–ë –†–§</div>
          <div class="summary-value">
            {% if diff_to_target is not None %}
              –¶–µ–ª–µ–≤–æ–π —É—Ä–æ–≤–µ–Ω—å –∏–Ω—Ñ–ª—è—Ü–∏–∏ –ë–∞–Ω–∫–∞ –†–æ—Å—Å–∏–∏:
              <strong>{{ target_rate|floatformat:1 }}%</strong>

              {% if diff_to_target > 0 %}
                <div class="delta-down">
                  ‚ñ≤ –§–∞–∫—Ç. –∏–Ω—Ñ–ª—è—Ü–∏—è –≤—ã—à–µ —Ü–µ–ª–∏ –Ω–∞ {{ diff_to_target|floatformat:2 }} –ø.–ø.
                </div>
              {% elif diff_to_target < 0 %}
                <div class="delta-up">
                  ‚ñº –§–∞–∫—Ç. –∏–Ω—Ñ–ª—è—Ü–∏—è –Ω–∏–∂–µ —Ü–µ–ª–∏ –Ω–∞ {{ diff_to_target|floatformat:2 }} –ø.–ø.
                </div>
              {% else %}
                <div class="delta-flat">
                  ‚ñ† –§–∞–∫—Ç. –∏–Ω—Ñ–ª—è—Ü–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ü–µ–ª–µ–≤–æ–º—É —É—Ä–æ–≤–Ω—é.
                </div>
              {% endif %}
            {% else %}
              ‚Äî
            {% endif %}
          </div>
        </div>
      </div>
    </div>


{# II. –ö—Ä–∞—Ç–∫–∞—è –∏—Å—Ç–æ—Ä–∏—è (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 6 –Ω–∞–±–ª—é–¥–µ–Ω–∏–π) #}
<div class="section section-divider">
  <div class="section-title">II. –ò—Å—Ç–æ—Ä–∏—è –∏–Ω—Ñ–ª—è—Ü–∏–∏ ‚Äî –ø–æ—Å–ª–µ–¥–Ω–∏–µ 6 –Ω–∞–±–ª—é–¥–µ–Ω–∏–π</div>
  <div class="section-sub">
    –ö—Ä–∞—Ç–∫–∞—è –¥–∏–Ω–∞–º–∏–∫–∞ –∏–Ω—Ñ–ª—è—Ü–∏–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –≥–æ–¥. –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è ‚Äî –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.
  </div>

  <table>
    <thead>
      <tr>
        <th class="col-date" style="width: 25%;">–î–∞—Ç–∞</th>
        <th class="col-s—É–º" style="width: 25%;">–ò–Ω—Ñ–ª—è—Ü–∏—è, %</th>
        <th class="col-delta" style="width: 25%;">
          Œî –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –ø–µ—Ä–∏–æ–¥—É, –ø.–ø.
        </th>
      </tr>
    </thead>

    <tbody>
      {% if history %}
        {% for item in history|slice:":6" %}
          <tr{% if current_rate_date and item.date == current_rate_date %} class="row-current"{% endif %}>

            <td class="col-date">
              {{ item.date|date:"d.m.Y" }}
            </td>

            <td class="col-sum">
              {{ item.rate|floatformat:2 }}%
            </td>

            <td class="col-delta" style=" white-space:nowrap; padding-right:8px;">
              {% if item.delta is not None %}
                {% if item.delta > 0 %}
                  <span class="delta-down">‚ñ≤ +{{ item.delta|floatformat:2 }}</span>
                {% elif item.delta < 0 %}
                  <span class="delta-up">‚ñº {{ item.delta|floatformat:2 }}</span>
                {% else %}
                  <span class="delta-flat">‚Ä¢ 0.00</span>
                {% endif %}
              {% else %}
                ‚Äî
              {% endif %}
            </td>

          </tr>
        {% endfor %}
      {% else %}
        <tr class="empty-row">
          <td colspan="3">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ –∏—Å—Ç–æ—Ä–∏–∏ –∏–Ω—Ñ–ª—è—Ü–∏–∏.</td>
        </tr>
      {% endif %}
    </tbody>

  </table>
</div>

    {# III. –ì—Ä–∞—Ñ–∏–∫ –∏–Ω—Ñ–ª—è—Ü–∏–∏ #}
    <div class="section section-divider">
      <div class="section-title">III. –ì—Ä–∞—Ñ–∏–∫ –∏–Ω—Ñ–ª—è—Ü–∏–∏</div>
      <div class="section-sub">
        –î–∏–Ω–∞–º–∏–∫–∞ –≥–æ–¥–æ–≤–æ–π –∏–Ω—Ñ–ª—è—Ü–∏–∏ –ø–æ –¥–∞—Ç–∞–º –Ω–∞–±–ª—é–¥–µ–Ω–∏–π. –ü—É–Ω–∫—Ç–∏—Ä–Ω–∞—è –ª–∏–Ω–∏—è –æ—Ç—Ä–∞–∂–∞–µ—Ç —Ü–µ–ª–µ–≤–æ–π —É—Ä–æ–≤–µ–Ω—å –∏–Ω—Ñ–ª—è—Ü–∏–∏ –ë–∞–Ω–∫–∞ –†–æ—Å—Å–∏–∏.
      </div>

      <div id="inflation-print-chart" class="valuation-kadastr-chart"></div>

      
    </div>

    {# IV. –ì—Ä–∞—Ñ–∏–∫ —Ç–µ–º–ø–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–Ω—Ñ–ª—è—Ü–∏–∏ #}
    <div class="section section-divider">
      <div class="section-title">IV. –¢–µ–º–ø—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–Ω—Ñ–ª—è—Ü–∏–∏</div>
      <div class="section-sub">
        –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≥–æ–¥–æ–≤–æ–π –∏–Ω—Ñ–ª—è—Ü–∏–∏ –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –Ω–∞–±–ª—é–¥–µ–Ω–∏—é (–ø.–ø.).
        –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –æ–∑–Ω–∞—á–∞—é—Ç —É—Å–∫–æ—Ä–µ–Ω–∏–µ –∏–Ω—Ñ–ª—è—Ü–∏–∏, –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ ‚Äî –µ—ë –∑–∞–º–µ–¥–ª–µ–Ω–∏–µ.
      </div>

      <div id="inflation-delta-chart" class="valuation-kadastr-chart"></div>
    </div>

    {# V. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Äî –ø–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è #}
    <div class="section section-divider page-break">
      <div class="section-title">
        –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ 1. –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –∏–Ω—Ñ–ª—è—Ü–∏–∏
      </div>
      <div class="section-sub">
        –í—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è –ø–æ –≥–æ–¥–æ–≤–æ–π –∏–Ω—Ñ–ª—è—Ü–∏–∏ (–ò–ü–¶, –≥–æ–¥ –∫ –≥–æ–¥—É).
      </div>

      <table>
        <thead>
          <tr>
            <th class="col-date">–î–∞—Ç–∞</th>
            <th class="col-sum">–ò–Ω—Ñ–ª—è—Ü–∏—è, %</th>
          </tr>
        </thead>
        <tbody>
          {% if history %}
            {% for item in history %}
              <tr{% if current_rate_date and item.date == current_rate_date %} class="row-current"{% endif %}>
                <td class="col-date">
                  {{ item.date|date:"d.m.Y" }}
                </td>
                <td class="col-sum">
                  {{ item.rate|floatformat:2 }}%
                </td>
              </tr>
            {% endfor %}
          {% else %}
            <tr class="empty-row">
              <td colspan="2">
                –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ –∏—Å—Ç–æ—Ä–∏–∏ –∏–Ω—Ñ–ª—è—Ü–∏–∏.
              </td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>

    {# VI. –ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –∑–∞–º–µ—Ç–∫–∞ #}
    <div class="section section-divider">
      <div class="section-title">–ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –∑–∞–º–µ—Ç–∫–∞</div>
      <div class="section-sub">
        –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å –æ—Ç—Ä–∞–∂–∞–µ—Ç –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—É—é –æ—Ü–µ–Ω–∫—É –≥–æ–¥–æ–≤–æ–π –∏–Ω—Ñ–ª—è—Ü–∏–∏ (–∏–∑–º–µ–Ω–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å—Å–∫–∏—Ö —Ü–µ–Ω, % –≥–æ–¥ –∫ –≥–æ–¥—É).
        –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å —Å–∞–π—Ç–∞ –ë–∞–Ω–∫–∞ –†–æ—Å—Å–∏–∏ –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—Ä–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ –º–∞–∫—Ä–æ—ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏—Ö
        –ø—Ä–µ–¥–ø–æ—Å—ã–ª–æ–∫, —Ä–∞—Å—á—ë—Ç–µ —Å—Ç–∞–≤–æ–∫ –¥–∏—Å–∫–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –∞—Ä–µ–Ω–¥–Ω—ã—Ö —Å—Ç–∞–≤–æ–∫.
        –¶–µ–ª–µ–≤–æ–π —É—Ä–æ–≤–µ–Ω—å –∏–Ω—Ñ–ª—è—Ü–∏–∏ –ë–∞–Ω–∫–∞ –†–æ—Å—Å–∏–∏ –Ω–∞ —Å—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω–æ–º –≥–æ—Ä–∏–∑–æ–Ω—Ç–µ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç {{ target_rate|floatformat:1 }}%.
      </div>
    </div>

    <div class="footer-note">
      –ü–µ—á–∞—Ç–Ω–∞—è —Ñ–æ—Ä–º–∞ –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.
      –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ –∏–Ω—Ñ–ª—è—Ü–∏–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è.
    </div>

  </div>

</div>

<script>
  const historyData = {{ history_json|default:"[]" }};
  const targetRate = {{ target_rate|default:"null" }};

  (function () {
    if (!historyData.length || typeof Plotly === 'undefined') return;

    // --- –æ—Å–Ω–æ–≤–Ω–æ–π –≥—Ä–∞—Ñ–∏–∫ –∏–Ω—Ñ–ª—è—Ü–∏–∏ ---

    const xDates  = historyData.map(p => p.date);
    const yValues = historyData.map(p => p.rate);

    const traceInflation = {
      x: xDates,
      y: yValues,
      type: "scatter",
      mode: "lines+markers",
      line: { shape: "spline", width: 3, color: "#2563eb" },
      marker: { size: 7, color: "#bfdbfe", line: { width: 2, color: "#2563eb" } },
      name: "–ò–Ω—Ñ–ª—è—Ü–∏—è, %",
      hovertemplate:
        "%{x|%d.%m.%Y}<br>" +
        "–ò–Ω—Ñ–ª—è—Ü–∏—è: %{y:.2f}%<extra></extra>"
    };

    const traceTarget = {
      x: xDates,
      y: xDates.map(() => targetRate),
      type: "scatter",
      mode: "lines",
      line: {
        dash: "dot",
        width: 2,
        color: "green"
      },
      name: `–¶–µ–ª–µ–≤–æ–π —É—Ä–æ–≤–µ–Ω—å –¶–ë –†–§ (${targetRate}%)`,
      hoverinfo: "skip"
    };

    const layoutMain = {
      margin: { l: 60, r: 20, t: 10, b: 60 },
      yaxis: {
        title: "–ò–Ω—Ñ–ª—è—Ü–∏—è, %",
        rangemode: "tozero"
      },
      xaxis: {
        type: "date",
        tickformat: "%Y",
        dtick: "M12",
        tickangle: 0,
        showgrid: true,
        ticks: "outside"
      },
      showlegend: true,
      legend: {
        orientation: "h",
        y: -0.3,
        x: 0,
        font: { size: 12 }
      }
    };

    const config = {
      displayModeBar: false,
      responsive: true
    };

    Plotly.newPlot("inflation-print-chart", [traceInflation, traceTarget], layoutMain, config);

    // --- –≥—Ä–∞—Ñ–∏–∫ —Ç–µ–º–ø–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–Ω—Ñ–ª—è—Ü–∏–∏ (Œî –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –ø–µ—Ä–∏–æ–¥—É) ---

    const deltaData = historyData.filter(p => p.delta !== null && p.delta !== undefined);

    if (deltaData.length) {
      const xDelta  = deltaData.map(p => p.date);
      const yDelta  = deltaData.map(p => p.delta);

      const maxDelta = Math.max(...yDelta, 0);
      const minDelta = Math.min(...yDelta, 0);

      // —Ü–≤–µ—Ç –∫–æ–ª–æ–Ω–æ–∫: —Ä–æ—Å—Ç –∏–Ω—Ñ–ª—è—Ü–∏–∏ (Œî>0) ‚Äî –∫—Ä–∞—Å–Ω—ã–π, –ø–∞–¥–µ–Ω–∏–µ (Œî<0) ‚Äî –∑–µ–ª—ë–Ω—ã–π
      const deltaColors = yDelta.map(v => {
        if (v > 0) return "rgba(220,38,38,0.75)";    // –∫—Ä–∞—Å–Ω—ã–π
        if (v < 0) return "rgba(22,163,74,0.75)";    // –∑–µ–ª—ë–Ω—ã–π
        return "rgba(148,163,184,0.75)";             // —Å–µ—Ä—ã–π ‚Äî –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
      });

      // –æ—Å–Ω–æ–≤–Ω–æ–π –±–∞—Ä-–≥—Ä–∞—Ñ–∏–∫ Œî –∏–Ω—Ñ–ª—è—Ü–∏–∏
      const traceDelta = {
        x: xDelta,
        y: yDelta,
        type: "bar",
        marker: {
          color: deltaColors
        },
        name: "–ò–∑–º–µ–Ω–µ–Ω–∏–µ –∏–Ω—Ñ–ª—è—Ü–∏–∏ –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –ø–µ—Ä–∏–æ–¥—É, –ø.–ø.",
        hovertemplate:
          "%{x|%d.%m.%Y}<br>" +
          "Œî –∏–Ω—Ñ–ª—è—Ü–∏–∏: %{y:+.2f} –ø.–ø.<extra></extra>"
      };

      // –≤—ã–¥–µ–ª—è–µ–º ‚Äú—à–æ–∫–∏‚Äù ‚Äî –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ –º–æ–¥—É–ª—é –≤—ã—à–µ –ø–æ—Ä–æ–≥–∞
      const threshold = 1.5;  // –ø.–ø., –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ –º–æ–∂–Ω–æ –ø–æ–¥—Å—Ç—Ä–æ–∏—Ç—å
      const highlightPoints = [];

      yDelta.forEach((v, i) => {
        if (Math.abs(v) >= threshold) {
          highlightPoints.push({
            x: xDelta[i],
            y: v,
            abs: Math.abs(v)
          });
        }
      });

      // –≤—Å–µ —Ç–æ—á–∫–∏-—à–æ–∫–∏ ‚Äî —Ä–∏—Å—É–µ–º —á—ë—Ä–Ω—ã–º–∏ –º–∞—Ä–∫–µ—Ä–∞–º–∏
      const traceDeltaHighlight = {
        x: highlightPoints.map(p => p.x),
        y: highlightPoints.map(p => p.y),
        type: "scatter",
        mode: "markers",
        marker: {
          size: 10,
          color: "black",
          line: { width: 1, color: "#f9fafb" }
        },
        name: `–°–∏–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (|Œî| ‚â• ${threshold} –ø.–ø.)`,
        hovertemplate:
          "%{x|%d.%m.%Y}<br>" +
          "–°–∏–ª—å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ: %{y:+.2f} –ø.–ø.<extra></extra>"
      };

      // –Ω–æ –ø–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å –±—É–¥–µ–º —Ç–æ–ª—å–∫–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–∞–º—ã—Ö —Å–∏–ª—å–Ω—ã—Ö –ø–æ –º–æ–¥—É–ª—é
      highlightPoints.sort((a, b) => b.abs - a.abs);
      const maxLabels = 5;  // –º–∞–∫—Å–∏–º—É–º –ø–æ–¥–ø–∏—Å–µ–π –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ
      const labeledPoints = highlightPoints.slice(0, maxLabels);

      const monthNames = ["—è–Ω–≤", "—Ñ–µ–≤", "–º–∞—Ä", "–∞–ø—Ä", "–º–∞–π", "–∏—é–Ω", "–∏—é–ª", "–∞–≤–≥", "—Å–µ–Ω", "–æ–∫—Ç", "–Ω–æ—è", "–¥–µ–∫"];

      const layoutDelta = {
        margin: { l: 60, r: 20, t: 10, b: 60 },
        yaxis: {
          title: "–ò–∑–º–µ–Ω–µ–Ω–∏–µ –∏–Ω—Ñ–ª—è—Ü–∏–∏, –ø.–ø."
        },
        xaxis: {
          type: "date",
          tickformat: "%Y",
          dtick: "M12",
          tickangle: 0,
          showgrid: true,
          ticks: "outside"
        },
        showlegend: true,
        legend: {
          orientation: "h",
          y: -0.3,
          x: 0,
          font: { size: 11 }
        },
        shapes: [
          // –∑–æ–Ω–∞ —É—Å–∫–æ—Ä–µ–Ω–∏—è (–≤—ã—à–µ –Ω—É–ª—è) ‚Äî –ª—ë–≥–∫–∏–π –∫—Ä–∞—Å–Ω—ã–π —Ñ–æ–Ω
          {
            type: "rect",
            xref: "x",
            yref: "y",
            x0: xDelta[0],
            x1: xDelta[xDelta.length - 1],
            y0: 0,
            y1: maxDelta,
            fillcolor: "rgba(248,113,113,0.08)",
            line: { width: 0 }
          },
          // –∑–æ–Ω–∞ –∑–∞–º–µ–¥–ª–µ–Ω–∏—è (–Ω–∏–∂–µ –Ω—É–ª—è) ‚Äî –ª—ë–≥–∫–∏–π –∑–µ–ª—ë–Ω—ã–π —Ñ–æ–Ω
          {
            type: "rect",
            xref: "x",
            yref: "y",
            x0: xDelta[0],
            x1: xDelta[xDelta.length - 1],
            y0: minDelta,
            y1: 0,
            fillcolor: "rgba(74,222,128,0.08)",
            line: { width: 0 }
          },
          // –Ω—É–ª–µ–≤–∞—è –ª–∏–Ω–∏—è
          {
            type: "line",
            xref: "x",
            yref: "y",
            x0: xDelta[0],
            x1: xDelta[xDelta.length - 1],
            y0: 0,
            y1: 0,
            line: {
              width: 2,
              color: "#4b5563"
            }
          }
        ],
        annotations: [
          {
            xref: "paper",
            yref: "paper",
            x: 0.01,
            y: 0.96,
            showarrow: false,
            align: "left",
            font: { size: 11, color: "rgba(220,38,38,0.9)" },
            text: "–í—ã—à–µ 0 ‚Äî —É—Å–∫–æ—Ä–µ–Ω–∏–µ –∏–Ω—Ñ–ª—è—Ü–∏–∏"
          },
          {
            xref: "paper",
            yref: "paper",
            x: 0.01,
            y: 0.05,
            showarrow: false,
            align: "left",
            font: { size: 11, color: "rgba(22,163,74,0.9)" },
            text: "–ù–∏–∂–µ 0 ‚Äî –∑–∞–º–µ–¥–ª–µ–Ω–∏–µ –∏–Ω—Ñ–ª—è—Ü–∏–∏"
          },

          // –ø–æ–¥–ø–∏—Å–∏ —Ç–æ–ª—å–∫–æ —É –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–∞–º—ã—Ö —Å–∏–ª—å–Ω—ã—Ö —à–æ–∫–æ–≤
          ...labeledPoints.map((p) => {
            const dateObj = new Date(p.x);
            return {
              xref: "x",
              yref: "y",
              x: p.x,
              y: p.y,
              text: monthNames[dateObj.getUTCMonth()] + " " + dateObj.getUTCFullYear(),
              showarrow: false,
              font: {
                size: 10,
                color: "#374151"
              },
              yanchor: "bottom",
              xanchor: "center",
              align: "center",
              bgcolor: "rgba(255,255,255,0.7)",
              bordercolor: "#9ca3af",
              borderwidth: 0.5,
              borderpad: 2
            };
          })
        ]
      };

      Plotly.newPlot("inflation-delta-chart", [traceDelta, traceDeltaHighlight], layoutDelta, config);
    }
  })();
</script>


</body>
</html>
