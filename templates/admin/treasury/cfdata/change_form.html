{% extends "admin/change_form.html" %}
{% load i18n admin_urls static admin_modify %}

{% block breadcrumbs %}{% endblock %}
{% block object-tools %}{% endblock %}

{% block title %}
  –ö–∞–∑–Ω–∞—á–µ–π—Å—Ç–≤–æ | CF –¥–æ–∫—É–º–µ–Ω—Ç{% if original %} ‚Äî {{ original }}{% endif %}
{% endblock %}

{% block content_title %}
  {% url opts|admin_urlname:'changelist' as changelist_url %}
  {% if original %}
    {% url opts|admin_urlname:'history' original.pk|admin_urlquote as history_url %}
  {% endif %}

  <div style="display:flex; align-items:flex-start; gap:16px; flex-wrap:wrap; padding-bottom:6px;">

    {# –õ–ï–í–ê–Ø –ß–ê–°–¢–¨ #}
    <div style="display:flex; align-items:flex-start; gap:12px; flex-wrap:wrap;">

      <div style="
          width:40px;height:40px;border-radius:10px;
          background:linear-gradient(135deg,#0ea5e9,#22c55e);
          color:#ecfeff;display:flex;align-items:center;justify-content:center;
          font-size:20px;font-weight:700;
          box-shadow:0 10px 26px rgba(34,197,94,.18), 0 0 0 1px rgba(15,23,42,.15);
      ">
        üßæ
      </div>

      <div style="display:flex; flex-direction:column; gap:4px; line-height:1.3; min-width:0;">
        <span style="font-size:11px;text-transform:uppercase;letter-spacing:0.06em;color:#6b7280;">
          –ö–∞–∑–Ω–∞—á–µ–π—Å—Ç–≤–æ
        </span>

        {# –ó–∞–≥–æ–ª–æ–≤–æ–∫ –≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ #}
        <span style="
            font-size:19px;
            font-weight:800;
            color:#0f172a;
            white-space: normal;
            overflow-wrap:anywhere;
            word-break: break-word;
            max-width:70vw;
            line-height:1.25;
            display:block;
        ">
          {% if original %}
            CF –¥–æ–∫—É–º–µ–Ω—Ç ‚Äî {{ original }}
          {% else %}
            –ù–æ–≤—ã–π CF –¥–æ–∫—É–º–µ–Ω—Ç
          {% endif %}
        </span>

        <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:2px;">
          {% if original %}
            <span style="font-size:11px;padding:2px 8px;border-radius:6px;background:rgba(14,165,233,.10);border:1px solid rgba(14,165,233,.18);color:#075985;font-weight:800;">
              ID: {{ original.pk }}
            </span>
          {% endif %}
          <span style="font-size:11px;padding:2px 8px;border-radius:6px;background:#f1f5f9;border:1px solid rgba(148,163,184,.25);color:#475569;font-weight:800;">
            {{ opts.verbose_name|capfirst }}
          </span>
        </div>
      </div>
    </div>

    <div style="flex:1;"></div>

    {# –ü–†–ê–í–ê–Ø –ö–ê–†–¢–û–ß–ö–ê: –¥–µ–π—Å—Ç–≤–∏—è #}
    <div style="
        min-width:260px;max-width:380px;
        border-radius:16px;
        background:rgba(248,250,252,0.92);
        box-shadow:0 18px 40px rgba(15,23,42,0.16);
        padding:10px 12px 12px;
        display:flex;flex-direction:column;gap:10px;
        border:1px solid rgba(148,163,184,.22);
        backdrop-filter: blur(6px);
    ">
      <div style="display:flex;justify-content:space-between;align-items:baseline;">
        <span style="font-size:11px;letter-spacing:0.14em;text-transform:uppercase;color:#9ca3af;">
          –ù–∞–≤–∏–≥–∞—Ü–∏—è
        </span>
        <span style="font-size:13px;font-weight:800;color:#0f172a;">
          –î–µ–π—Å—Ç–≤–∏—è
        </span>
      </div>

      <div style="display:flex; flex-direction:column; gap:6px;">
        <a href="{{ changelist_url }}"
           style="
             font-size:11px;padding:6px 8px;border-radius:10px;text-decoration:none;
             background:#f3f4f6;color:#4b5563;display:inline-flex;align-items:center;gap:8px;
             border:1px solid rgba(148,163,184,.25);
           ">
          ‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É
        </a>

        {% if original %}
          <a href="{{ history_url }}"
             style="
               font-size:11px;padding:6px 8px;border-radius:10px;text-decoration:none;
               background:rgba(14,165,233,.10);color:#075985;display:inline-flex;align-items:center;gap:8px;
               border:1px solid rgba(14,165,233,.18);
             ">
            üïí –ò—Å—Ç–æ—Ä–∏—è
          </a>
        {% endif %}
      </div>

      <div style="
          margin-top:2px;padding-top:8px;
          border-top:1px solid rgba(148,163,184,.25);
          color:#64748b;font-size:11px;line-height:1.35;
      ">
        <div style="display:flex;gap:8px;flex-wrap:wrap;">
          <span style="opacity:.9;">–ü–æ–¥—Å–∫–∞–∑–∫–∞:</span>
          <span style="font-weight:800;color:#0f172a;">Ctrl/Cmd + S</span>
          <span>‚Äî —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å.</span>
        </div>
      </div>
    </div>
  </div>

  {# –ù–ò–ñ–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ (breadcrumbs) #}
  <div style="
      display:flex;justify-content:space-between;align-items:center;
      margin-top:4px;padding:6px 2px 0;
      border-top:1px solid #e5e7eb;
      color:#6b7280;font-size:11px;
  ">
    <nav style="display:flex;align-items:center;gap:4px;flex-wrap:wrap;">
      <a href="{% url 'admin:index' %}"
         style="text-transform:uppercase;letter-spacing:0.08em;text-decoration:none;color:#9ca3af;">
        –ù–ê–ß–ê–õ–û
      </a>
      <span>‚Ä∫</span>
      <span style="text-transform:uppercase;letter-spacing:0.08em;color:#9ca3af;">
        –ö–ê–ó–ù–ê–ß–ï–ô–°–¢–í–û
      </span>
      <span>‚Ä∫</span>
      <a href="{{ changelist_url }}"
         style="text-transform:uppercase;letter-spacing:0.08em;text-decoration:none;color:#9ca3af;">
        CF –î–û–ö–£–ú–ï–ù–¢–´
      </a>
      <span>‚Ä∫</span>
      <span style="text-transform:uppercase;letter-spacing:0.08em;color:#475569;font-weight:800;">
        {% if original %}–ö–ê–†–¢–û–ß–ö–ê{% else %}–°–û–ó–î–ê–ù–ò–ï{% endif %}
      </span>
    </nav>

    <span style="color:#9ca3af;">
      {% if original %}—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ{% else %}—Å–æ–∑–¥–∞–Ω–∏–µ{% endif %}
    </span>
  </div>
{% endblock %}

{% block extrahead %}
  {{ block.super }}
  <style>
    .content > h1 { display:none; }
    #content-main { max-width: 1400px; }

    /* Fieldset */
    fieldset.module{
      border-radius: 16px !important;
      border: 1px solid rgba(148,163,184,.28) !important;
      box-shadow: 0 16px 40px rgba(15,23,42,.10);
      background: rgba(255,255,255,.92);
      overflow: hidden;
    }
    fieldset.module h2{
      padding: 10px 12px !important;
      background: linear-gradient(180deg, rgba(248,250,252,.96), rgba(241,245,249,.96));
      border-bottom: 1px solid rgba(148,163,184,.25);
      font-weight: 900 !important;
      color: #0f172a !important;
    }
    fieldset.module .form-row{
      padding: 10px 12px !important;
      border-bottom: 1px solid rgba(148,163,184,.18);
    }
    fieldset.module .form-row:last-child{ border-bottom:none; }

    /* Inputs */
    input[type="text"], input[type="number"], input[type="email"], input[type="url"], input[type="password"],
    textarea, select{
      border-radius: 12px !important;
      border: 1px solid rgba(148,163,184,.40) !important;
      padding: 8px 10px !important;
      background: #fff !important;
      font-weight: 700;
      color: #0f172a;
      outline: none;
    }

    /* --- –ö–õ–Æ–ß–ï–í–´–ï –ü–û–õ–Ø (–ø–æ —Ç–æ—á–Ω—ã–º –∏–º–µ–Ω–∞–º CfData) --- */
    .form-row.field-cp_final,
    .form-row.field-contract,
    .form-row.field-cfitem{
      border-radius: 14px;
      background: linear-gradient(180deg, rgba(14,165,233,.08), rgba(34,197,94,.06));
      border: 1px solid rgba(14,165,233,.22);
      box-shadow: 0 16px 36px rgba(15,23,42,.10);
      position: relative;
    }

    .form-row.field-cp_final label,
    .form-row.field-contract label,
    .form-row.field-cfitem label{
      color:#0f172a !important;
      font-weight: 950 !important;
      position: relative;
      padding-left: 18px;
    }
    .form-row.field-cp_final label:before,
    .form-row.field-contract label:before,
    .form-row.field-cfitem label:before{
      content:"";
      width:10px;height:10px;border-radius:999px;
      background:linear-gradient(135deg,#0ea5e9,#22c55e);
      position:absolute;left:0;top:50%;
      transform:translateY(-50%);
      box-shadow:0 6px 14px rgba(14,165,233,.25);
    }

    /* –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Å–µ–ª–µ–∫—Ç–æ–≤/–ø–æ–ª–µ–π –∏–º–µ–Ω–Ω–æ –≤–Ω—É—Ç—Ä–∏ –∫–ª—é—á–µ–≤—ã—Ö —Å—Ç—Ä–æ–∫ */
    .form-row.field-cp_final select,
    .form-row.field-contract select,
    .form-row.field-cfitem select,
    .form-row.field-cp_final input,
    .form-row.field-contract input,
    .form-row.field-cfitem input{
      border-color: rgba(14,165,233,.42) !important;
      box-shadow: 0 0 0 4px rgba(14,165,233,.08);
    }

    /* Django related-widget-wrapper (–∏–∫–æ–Ω–∫–∏ –∫–∞—Ä–∞–Ω–¥–∞—à/–ø–ª—é—Å/–≥–ª–∞–∑) */
    .related-widget-wrapper{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }
    .related-widget-wrapper-link{
      opacity: .95;
      transform: translateY(1px);
    }
    .related-widget-wrapper-link:hover{
      opacity: 1;
      filter: drop-shadow(0 6px 14px rgba(15,23,42,.18));
    }

    /* Select2 (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω –≤ –∞–¥–º–∏–Ω–∫–µ) */
    .select2-container--admin-autocomplete .select2-selection--single{
      border-radius:12px !important;
      border:1px solid rgba(148,163,184,.40) !important;
      min-height: 36px;
      padding: 4px 8px;
      display:flex;
      align-items:center;
    }
    .form-row.field-cp_final .select2-container--admin-autocomplete .select2-selection--single,
    .form-row.field-contract .select2-container--admin-autocomplete .select2-selection--single,
    .form-row.field-cfitem .select2-container--admin-autocomplete .select2-selection--single{
      border-color: rgba(14,165,233,.42) !important;
      box-shadow: 0 0 0 4px rgba(14,165,233,.08);
    }

    /* Sticky submit row */
    .submit-row{
      position: sticky;
      bottom: 10px;
      z-index: 50;
      border-radius: 16px;
      border: 1px solid rgba(148,163,184,.22);
      background: rgba(248,250,252,.92);
      backdrop-filter: blur(8px);
      box-shadow: 0 18px 40px rgba(15,23,42,0.18);
      padding: 10px 12px !important;
      margin-top: 14px !important;
    }
    .submit-row input{
      border-radius: 12px !important;
      font-weight: 900 !important;
    }
    .submit-row input[name="_save"]{
      border: 1px solid rgba(34,197,94,.22) !important;
      background: rgba(34,197,94,.12) !important;
    }
    .submit-row input[name="_continue"], .submit-row input[name="_addanother"]{
      border: 1px solid rgba(14,165,233,.22) !important;
      background: rgba(14,165,233,.10) !important;
    }

    

    

    /* –ï—Å–ª–∏ —Ö–æ—á–µ—à—å –í–û–û–ë–©–ï —Å–∫—Ä—ã—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ –≤–Ω–∏–∑—É ‚Äî —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π */
    /* .submit-row a.deletelink{ display:none !important; } */
  </style>

  <script>
    // Ctrl/Cmd+S -> —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å
    document.addEventListener('keydown', function(e){
      const isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;
      const mod = isMac ? e.metaKey : e.ctrlKey;
      if (!mod) return;
      if (e.key.toLowerCase() !== 's') return;
      e.preventDefault();
      const btn = document.querySelector('.submit-row input[name="_save"]');
      if (btn) btn.click();
    });
  </script>
{% endblock %}

{% block content %}
  {{ block.super }}
{% endblock %}
